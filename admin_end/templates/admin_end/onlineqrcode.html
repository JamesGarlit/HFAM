{% extends "admin_end/base.html" %}
{% load static %}
{% block content %}
<!-- Page header -->
<div class="page-header d-print-none">
    <div class="container-xl">
        <div class="row g-2 align-items-center">
            <div class="col">
                <!-- Page pre-title -->
                <div class="page-pretitle">
                    Overview
                </div>
                <h2 class="page-title">
                    Contactless
                </h2>
            </div>
            <!-- Page title actions -->
        </div>
    </div>
</div>
<!-- Page body -->
<div class="page-body">
    <div class="container-xl">
        <div class="card">
            <div class="card-body">
                <div class="row">
                    <div class="col d-flex justify-content-center">
                        {% comment %} <div class="border m-2" id="qrcode1"></div> {% endcomment %}
                        <div class="border m-2" id="qrcode2"></div>
                    </div>
                </div>
                <div class="row">
                    <div class="col text-center">
                        <button class="btn btn-sm btn-primary m-1" onclick="generateQRCode()" id="generateBtn">Generate QR Code</button>
                        <button class="btn btn-sm btn-primary m-1" id="downloadBtn" onclick="downloadQRCode()" disabled>Download QR Code</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% block css %}
<style>
</style>
{% endblock %}
{% block javascript %}
<script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
<script>
    function generateQRCode() {
        // Remove the existing QR codes
        document.getElementById('qrcode2').innerHTML = '';

        // Generate QR code for "online_time_in"
        generateQRCodeForText('https://hfam-mdf2.onrender.com/online_time_in/', 'qrcode2');

        // Enable download button
        document.getElementById('downloadBtn').disabled = false;

        // Disable generate button
        document.getElementById('generateBtn').disabled = true;
    }

    function generateQRCodeForText(text, elementId) {
        const qrText = text;

        // Generate new QR code with white border
        const qrcode = new QRCode(document.getElementById(elementId), {
            text: qrText,
            width: 400,
            height: 400,
            colorDark: "#000000",  // Dark color of QR code
            colorLight: "#ffffff", // Light color of QR code (white border)
            correctLevel: QRCode.CorrectLevel.H
        });
    }

    function downloadQRCode() {
        // Get the canvas elements generated by qrcode.min.js
        const canvas2 = document.getElementById('qrcode2').querySelector('canvas');

        // Create temporary link elements
        const downloadLink2 = document.createElement('a');

        // Convert the canvas to data URLs
        const dataUrl2 = canvas2.toDataURL('image/png');

        // Create the file names
        const fileName2 = 'online_time_in.png';

        // Set the data URLs as the href attributes
        downloadLink2.href = dataUrl2;
        downloadLink2.download = fileName2;

        // Append the links to the body and trigger the downloads
        document.body.appendChild(downloadLink2);
        downloadLink2.click();

        // Remove the links from the body
        document.body.removeChild(downloadLink2);
    }

</script>
{% endblock %}
{% endblock %}