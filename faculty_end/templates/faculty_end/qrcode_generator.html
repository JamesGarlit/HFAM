{% extends 'faculty_end/base.html' %}
{% load static %}
{% block content %}

<!-- Page header -->
<div class="page-header d-print-none">
    <div class="container-xl">
        <div class="row g-2 align-items-center">
            <div class="col">
                <h2 class="page-title">
                    QR Code Generator
                </h2>
            </div>
        </div>
    </div>
</div>
<!-- Page body -->
<div class="page-body">
    <div class="container-xl">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Generate Your QR Code</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col d-flex justify-content-center">
                        <div class="border m-2" id="qrcode1"></div>
                        <div class="border m-2" id="qrcode2"></div>
                    </div>
                </div>
                <div class="row">
                    <div class="col text-center">
                        <button class="btn btn-sm btn-primary m-1" onclick="generateQRCode()" id="generateBtn">Generate QR Code</button>
                        <button class="btn btn-sm btn-primary m-1" id="downloadBtn" onclick="downloadQRCode()" disabled>Download QR Code</button>
                    </div>
                </div>
            </div>            
        </div>
    </div>
</div>
{% block css %}
<!-- Include external CSS stylesheets -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
<!-- Additional CSS for the specific page -->
<style>
    /* Your specific page CSS styles */
</style>
{% endblock %}

{% block javascript %}
<script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
<script>
    function generateQRCode() {
        // Remove the existing QR codes
        document.getElementById('qrcode1').innerHTML = '';
        document.getElementById('qrcode2').innerHTML = '';

        // Generate QR code for "log_time_in"
        generateQRCodeForText('log_time_in', 'qrcode1');

        // Generate QR code for "online_time_in"
        generateQRCodeForText('online_time_in', 'qrcode2');

        // Enable download button
        document.getElementById('downloadBtn').disabled = false;

        // Disable generate button
        document.getElementById('generateBtn').disabled = true;
    }

    function generateQRCodeForText(text, elementId) {
        const qrText = text;

        // Generate new QR code with white border
        const qrcode = new QRCode(document.getElementById(elementId), {
            text: qrText,
            width: 400,
            height: 400,
            colorDark: "#000000",  // Dark color of QR code
            colorLight: "#ffffff", // Light color of QR code (white border)
            correctLevel: QRCode.CorrectLevel.H
        });
    }

    function downloadQRCode() {
        // Get the canvas elements generated by qrcode.min.js
        const canvas1 = document.getElementById('qrcode1').querySelector('canvas');
        const canvas2 = document.getElementById('qrcode2').querySelector('canvas');

        // Create temporary link elements
        const downloadLink1 = document.createElement('a');
        const downloadLink2 = document.createElement('a');

        // Convert the canvas to data URLs
        const dataUrl1 = canvas1.toDataURL('image/png');
        const dataUrl2 = canvas2.toDataURL('image/png');

        // Create the file names
        const fileName1 = 'log_time_in.png';
        const fileName2 = 'online_time_in.png';

        // Set the data URLs as the href attributes
        downloadLink1.href = dataUrl1;
        downloadLink1.download = fileName1;
        downloadLink2.href = dataUrl2;
        downloadLink2.download = fileName2;

        // Append the links to the body and trigger the downloads
        document.body.appendChild(downloadLink1);
        downloadLink1.click();
        document.body.appendChild(downloadLink2);
        downloadLink2.click();

        // Remove the links from the body
        document.body.removeChild(downloadLink1);
        document.body.removeChild(downloadLink2);
    }

</script>
{% endblock %}
{% endblock %}